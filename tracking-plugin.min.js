(()=>{"use strict";let e="http://localhost:8080",n=`${e}/api/session`,t=`${e}/api/activity`,o=`${e}/api/session/end`,i="N2cH/ZGTyBWNhUWfcWq7+g==";function s(e,n={},o=null){console.log(n,"<<additionalData");const s={session_id:parseInt(a()),activity_data:{activity_type:e,...n},page_url:n?.page_url||window.location.href,type:e,...o||n?.type_id?{type_id:o||n?.type_id}:{}};fetch(t,{method:"POST",headers:{"Content-Type":"application/json",apikey:i},body:JSON.stringify(s),keepalive:!0}).catch((e=>console.error("Activity tracking failed:",e)))}function r(e,n,t){const o=new Date(Date.now()+60*t*1e3).toUTCString(),i=`${e}=${encodeURIComponent(n)}; expires=${o}; path=/`;document.cookie=i}function a(){return function(){const e=`; ${document.cookie}`.split("; session_id=");if(2===e.length)return decodeURIComponent(e.pop().split(";").shift())}()}function c(){const e="user_id";return function(e){const n=`; ${document.cookie}`.split(`; ${e}=`);if(2===n.length)return decodeURIComponent(n.pop().split(";").shift())}(e)||localStorage.getItem(e)}async function l(n){const t="user_id";!function(e,n){const t=new Date(Date.now()+31536e6).toUTCString();document.cookie=e+"="+encodeURIComponent(n)+"; expires="+t+"; path=/"}(t,n),localStorage.setItem(t,n);const o=a();if(o)try{await async function(n,t){console.log("parseInt update");const o=`${e}/api/session/${n}`,s={id:parseInt(n),contact_id:parseInt(t),user_agent:navigator.userAgent};try{const e=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",apikey:i},body:JSON.stringify(s)});if(!e.ok){const n=await e.text();throw new Error(`API responded with status ${e.status}: ${n}`)}}catch(e){throw console.error(`Failed to update session ${n} with user ID ${t}:`,e),e}}(o,n),s("user_login",{activity_data:{user_id:n},page_url:window.location.href,type:"user_login",type_id:null})}catch(e){console.error(`Error associating user ID ${n} with session ${o}:`,e)}else console.error("No active session found. Cannot associate user ID.")}let d=null;function u(){a()?p():function(){console.log("craeting new sessionnnnnnnnnnnnnnnnnnnnnnnnnnnn");const e=c();console.log(e,"1"),console.log(typeof e,"typeof used"),console.log(typeof parseInt(e),"typeof used"),function(e){const t={ip_address:e.ip_address||null,coordinates:e.coordinates||null,city:e.city||null,state:e.state||null,country:e.country||null,user_agent:navigator.userAgent,session_start:e.session_start||(new Date).toISOString(),channel:e.channel||null,referrer:e.referrer||document.referrer,...e.contact_id&&{contact_id:parseInt(c())},...e.session_end&&{session_end:e.session_end},...e.time_spent&&{time_spent:e.time_spent}};console.log(t,"<<<<<<<<<<<<<<<<<<<<<<<<<<<payload"),fetch(n,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":navigator.userAgent,apikey:i},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{e?.data?.id&&function(e){const n="session_id";r(n,e,30),localStorage.setItem(n,e)}(e.data.id)})).catch((e=>console.error("Session tracking failed:",e)))}({contact_id:parseInt(e),ip_address:null,coordinates:null,city:null,state:null,country:null,channel:"online",referrer:document.referrer,session_start:(new Date).toISOString()}),p()}()}function p(){d&&clearTimeout(d),d=setTimeout((()=>{!function(){console.log("end session");const e=a();e&&function(e,n=null){const t={session_id:e,session_end:n?new Date(n).toISOString():(new Date).toISOString()};fetch(o,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":navigator.userAgent,apikey:i},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{})).catch((e=>console.error("End session tracking failed:",e)))}(e),function(){const e="session_id";r(e,"",-1),localStorage.removeItem(e)}(),function(){const e="user_id";r(e,"",-1),localStorage.removeItem(e)}()}()}),18e5)}function f(e){if(!(e instanceof Element))return null;const n=[];for(;e.nodeType===Node.ELEMENT_NODE;){let t=e.nodeName.toLowerCase();if(e.id){t+=`#${e.id}`,n.unshift(t);break}{let n=e,o=1;for(;n=n.previousElementSibling;)n.nodeName.toLowerCase()===t&&o++;1!==o&&(t+=`:nth-of-type(${o})`)}n.unshift(t),e=e.parentNode}return n.join(" > ")}function g(){(function(){const e=window.location.pathname,{category:n,identifier:t}=function(e){const n=e.split("/").filter((e=>e));return n.length>=2?{category:n[0],identifier:n.slice(1).join("/")}:{category:"home",identifier:e}}(e);s("page_view",{activity_data:{category:n,identifier:t},page_url:window.location.href,type:n,type_id:null})})(),document.addEventListener("click",(function(e){const n=e.target.closest("a, button, input, select, textarea");if(n){console.log("updateddd add event listener");const t="a"===n.tagName.toLowerCase()&&n.href,o="button"===n.tagName.toLowerCase();let i=null;if(t)i=n.href;else if(o){const e=window.location.href,n=function(){const t=window.location.href;t!==e&&(i=t),window.removeEventListener("click",n)};window.addEventListener("click",n)}console.log(i,"<<<<<<<<<<<<<<<<<<<<<<<<<<redirectUrl"),s("click",{activity_data:{tag:n.tagName.toLowerCase(),id:n.id||null,classes:n.className||null,text:n.innerText||null,x:e.clientX,y:e.clientY,selector:f(n)},page_url:window.location.href,type:"click",type_id:null,test:"key",redirect_url:i})}}))}console.log("Imported setUserId:",l),function(e){try{u(),g(),e.TrackingPlugin={setUserId:function(e){l(e)},trackCustomActivity:function(e,n,t){""!==e.trim()?s(e,t,n):console.error("Invalid activityType provided to trackCustomActivity.")},config:function(e){var i;e.apiUrl&&(i=e.apiUrl,i?.sessionUrl&&(n=i.sessionUrl),i?.activityUrl&&(t=i.activityUrl),i?.endSessionUrl&&(o=i.endSessionUrl))}}}catch(e){console.error("Error initializing TrackingPlugin:",e)}}(window)})();