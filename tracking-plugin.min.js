(()=>{"use strict";let t="http://localhost:8080",e=`${t}/api/session`,n=`${t}/api/activity`,o=`${t}/api/session/end`,i="N2cH/ZGTyBWNhUWfcWq7+g==";function s(t){const n={ip_address:t.ip_address||null,coordinates:t.coordinates||null,city:t.city||null,state:t.state||null,country:t.country||null,user_agent:navigator.userAgent,session_start:t.session_start||(new Date).toISOString(),channel:t.channel||null,referrer:t.referrer||document.referrer,...t.contact_id&&{contact_id:parseInt(c())},...t.session_end&&{session_end:t.session_end},...t.time_spent&&{time_spent:t.time_spent}};fetch(e,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":navigator.userAgent,apikey:i},body:JSON.stringify(n)}).then((t=>t.json())).then((t=>{t?.data?.id&&function(t){const e="session_id";(function(t,e,n){const o=new Date(Date.now()+60*n*1e3).toUTCString(),i=`${t}=${encodeURIComponent(e)}; expires=${o}; path=/`;document.cookie=i})(e,t,30),localStorage.setItem(e,t)}(t.data.id)})).catch((t=>console.error("Session tracking failed:",t)))}function a(t,e={},o=null){const s={session_id:parseInt(r()),activity_data:{activity_type:t,...e},page_url:e?.page_url||window.location.href,type:t,...o||e?.type_id?{type_id:o||e?.type_id}:{}};fetch(n,{method:"POST",headers:{"Content-Type":"application/json",apikey:i},body:JSON.stringify(s),keepalive:!0}).catch((t=>console.error("Activity tracking failed:",t)))}function r(){return function(){const t=`; ${document.cookie}`.split("; session_id=");if(2===t.length)return decodeURIComponent(t.pop().split(";").shift())}()}function c(){const t="user_id";return function(t){const e=`; ${document.cookie}`.split(`; ${t}=`);if(2===e.length)return decodeURIComponent(e.pop().split(";").shift())}(t)||localStorage.getItem(t)}async function l(e){const n="user_id";!function(t,e){const n=new Date(Date.now()+31536e6).toUTCString();document.cookie=t+"="+encodeURIComponent(e)+"; expires="+n+"; path=/"}(n,e),localStorage.setItem(n,e);const o=r();if(o)try{await async function(e,n){console.log("parseInt update");const o=`${t}/api/session/${e}`,s={id:parseInt(e),contact_id:parseInt(n),user_agent:navigator.userAgent};try{const t=await fetch(o,{method:"PUT",headers:{"Content-Type":"application/json",apikey:i},body:JSON.stringify(s)});if(!t.ok){const e=await t.text();throw new Error(`API responded with status ${t.status}: ${e}`)}}catch(t){throw console.error(`Failed to update session ${e} with user ID ${n}:`,t),t}}(o,e),a("user_login",{activity_data:{user_id:e},page_url:window.location.href,type:"user_login",type_id:null})}catch(t){console.error(`Error associating user ID ${e} with session ${o}:`,t)}else console.error("No active session found. Cannot associate user ID.")}let d=null;function u(){d&&clearTimeout(d),d=setTimeout((()=>{!function(){const t=r();t&&function(t,e=null){const n={session_id:t,session_end:e?new Date(e).toISOString():(new Date).toISOString()};fetch(o,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":navigator.userAgent,apikey:i},body:JSON.stringify(n)}).then((t=>t.json())).then((t=>{})).catch((t=>console.error("End session tracking failed:",t)))}(t)}()}),18e5)}function p(t){if(!(t instanceof Element))return null;const e=[];for(;t.nodeType===Node.ELEMENT_NODE;){let n=t.nodeName.toLowerCase();if(t.id){n+=`#${t.id}`,e.unshift(n);break}{let e=t,o=1;for(;e=e.previousElementSibling;)e.nodeName.toLowerCase()===n&&o++;1!==o&&(n+=`:nth-of-type(${o})`)}e.unshift(n),t=t.parentNode}return e.join(" > ")}function f(){(function(){const t=window.location.pathname,{category:e,identifier:n}=function(t){const e=t.split("/").filter((t=>t));return e.length>=2?{category:e[0],identifier:e.slice(1).join("/")}:{category:"home",identifier:t}}(t);a("page_view",{activity_data:{category:e,identifier:n},page_url:window.location.href,type:e,type_id:null})})(),function(){document.addEventListener("click",(function(t){const e=t.target.closest("a, button, input, select, textarea");e&&a("click",{activity_data:{tag:e.tagName.toLowerCase(),id:e.id||null,classes:e.className||null,text:e.innerText||null,x:t.clientX,y:t.clientY,selector:p(e)},page_url:window.location.href,type:"click",type_id:null})})),document.addEventListener("submit",(function(t){const e=t.target;a("form_submit",{activity_data:{id:e.id||null,classes:e.className||null,action:e.action||null,method:e.method||null,selector:p(e)},page_url:window.location.href,type:"form_submit",type_id:null})}));let t=0;window.addEventListener("scroll",(function(){const e=window.scrollY/(document.body.offsetHeight-window.innerHeight)*100;e-t>=10&&(t=e,a("scroll_depth",{activity_data:{percentage:Math.floor(e)},page_url:window.location.href,type:"scroll_depth",type_id:null}))})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?a("page_hidden",{activity_data:{},page_url:window.location.href,type:"page_hidden",type_id:null}):"visible"===document.visibilityState&&a("page_visible",{activity_data:{},page_url:window.location.href,type:"page_visible",type_id:null})}))}()}console.log("Imported setUserId:",l),function(t){try{r()?u():function(){console.log("craeting new sessionnnnnnnnnnnnnnnnnnnnnnnnnnnn");const t=c();console.log(t,"1"),console.log(typeof t,"typeof used"),console.log(typeof parseInt(t),"typeof used"),s({contact_id:parseInt(t),ip_address:null,coordinates:null,city:null,state:null,country:null,channel:"online",referrer:document.referrer,session_start:(new Date).toISOString()}),u()}(),f(),t.TrackingPlugin={setUserId:function(t){l(t)},trackCustomActivity:function(t,e,n){""!==t.trim()?a(t,n,e):console.error("Invalid activityType provided to trackCustomActivity.")},config:function(t){var i;t.apiUrl&&(i=t.apiUrl,i?.sessionUrl&&(e=i.sessionUrl),i?.activityUrl&&(n=i.activityUrl),i?.endSessionUrl&&(o=i.endSessionUrl))}}}catch(t){console.error("Error initializing TrackingPlugin:",t)}}(window)})();